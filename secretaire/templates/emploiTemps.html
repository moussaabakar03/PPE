{% load dict_utils %}


{% load static %}
<!doctype html>
<html class="no-js" lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>AcadPro | Emploi du Temps</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'secretaire/img/favicon.png' %}">
    <!-- Normalize CSS -->
    <link rel="stylesheet" href="{% static 'secretaire/css/normalize.css' %}">
    <!-- Main CSS -->
    <link rel="stylesheet" href="{% static 'secretaire/css/main.css' %}">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="{% static 'secretaire/css/bootstrap.min.css' %}">
    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="{% static 'secretaire/css/all.min.css' %}">
    <!-- Flaticon CSS -->
    <link rel="stylesheet" href="{% static 'secretaire/fonts/flaticon.css' %}">
    <!-- Animate CSS -->
    <link rel="stylesheet" href="{% static 'secretaire/css/animate.min.css' %}">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'secretaire/style.css' %}">

    <link rel="stylesheet" href="{% static 'accueil/css/cssPersonnalise/receptionDepotDossier.css' %}">

    <!-- Modernize js -->
    <script src="{% static 'secretaire/js/modernizr-3.6.0.min.js' %}"></script>

    <style>
       
        .container {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            overflow-x: auto; /* permet le scroll horizontal si nécessaire */
          }
          
        .table-wrapper {
        overflow-x: auto;
        width: 100%;
        }

        h2 {
          font-size: 18px;
          margin-bottom: 10px;
          color: #333;
        }
       
        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 10px;
        }
    
        th, td {
          text-align: left;
          padding: 8px;
          border: solid 0.5px black;
          border-collapse: collapse;
        }
    
        th {
          color:rgb(203, 150, 58);
          font-weight: bold;
          background: #f9f9f9;
        }
    
        tr:nth-child(even) {
          background: #f1f1f1;
        }
    
        .action-icons img {
          height: 24px;
          margin-right: 10px;
          cursor: pointer;
        }
    
        .flex-boxes {
          display: flex;
          gap: 20px;
          flex-wrap: wrap;
        }
    
        .box {
          flex: 1;
          min-width: 300px;
        }

        .table-wrapper table tr {
            height: 70px; /* augmente la hauteur des lignes */
        }

        .detailEtudiant{
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #ffa001;
          
            width: 50%;
            margin: 20px auto;
            border-radius: 10px;

        }
    </style>
</head>

<body>
    <!-- Preloader Start Here -->
    <div id="preloader"></div>
    <!-- Preloader End Here -->
    <div id="wrapper" class="wrapper bg-ash">
         <!-- Header Menu Area Start Here -->
       
         {% include 'partial/header.html' %}


        <!-- Header Menu Area End Here -->
        <!-- Page Area Start Here -->
        <div class="dashboard-page-one">
            <!-- Sidebar Area Start Here -->
           
            {% include 'partial/aside.html' %}
            <!-- Modal de réponse -->
            <div id="modalOverlay" class="modal-overlay">
                <div class="modal-content-custom">
                    <div class="modal-header-custom">
                        <h4  style="text-align: center; font-weight: bold; margin-top: 20px;">Réponse</h4>
                        <button type="button" class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-header-custom">
                        <h5>Veillez entre le jour dont le nombre d'heures de cours est maximal </h5>
                    </div>
                    {% comment %} <div id="successMessage" class="success-message" style="display: none;">
                        Votre message a bien été envoyé. Merci !
                    </div> {% endcomment %}
                    <form id="responseForm" method="POST">
                        {% csrf_token %}
                        <input type="hidden" id="salleId" name="salleId" value="">
                        <input type="hidden" id="anneeId" name="anneeId" value="">

                        <div class="form-group">
                            <label for="nombreHeure">Début des cours</label>
                            <input type="number" id="receptionId" name="debutHeure" placeholder="7h" min="1" max="24" required>
                        </div>

                        <div class="form-group">
                            <label for="nombreHeure">Fin des cours</label>
                            <input type="number" name="finHeure" placeholder="12h" min="1" max="24" required>
                        </div>
                        
                        <div class="button-container">
                            <button type="button" onclick="closeModal()" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Annuler
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Envoyer
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Sidebar Area End Here -->
            <div class="dashboard-content-one">

                <!-- Breadcubs Area Start Here -->
                <div class="breadcrumbs-area">
                    <h3>Emploi du Temps</h3>
                    <div style ="display: flex; justify-content: space-between;">
                        <ul>
                            <li>{{salle.niveau.classe}}- {{salle.nom}}</li>
                            <li><a href ="{% url 'secretaire:studentParSalle' salle.id annee.id %}"> Retour<a></li>
                            <li> Emploi du temps</li>
                        </ul>
                        <ul>
                            {% comment %} <li><a href ="{% url 'secretaire:ajoutEmploiTemps' salle.id annee.id salle.niveau.id %}"> <i class="fa fa-plus"></i> Ajout nouvel Emploi du Temps<a></li> {% endcomment %}
                            <li><a href ="#" onclick="openModal('{{ salle.id }}', '{{ annee.id }}')"> <i class="fa fa-plus"></i> Ajout nouvel Emploi du Temps<a></li>
                        </ul>
                    </div>

                </div>
                <!-- Breadcubs Area End Here -->
                <!-- etudiant Details Area Start Here -->
                <div class="card height-auto">
                    <div class="flex-boxes">
                        <div class="container box">
                            <div class="row">
                                {% for message in messages %}
                                    <div class="alert alert-warning alert-dismissible fade show" role="alert" style = "text-align: center;">
                                        <strong >{{ message }} </strong> 
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style = "cursor: pointer;">❌</button>
                                    </div>
                                {% endfor %}
                            </div>

                            <div style = "display: flex; justify-content: space-between;">
                                <h6>Emploi du temps de la salle de classe: <span style = "font-weight: bold; color: #ffaa01; font-size: 17px;"> << {{salle.niveau.classe}}  {{salle.nom}} >> </span></h6>
                                <h6>Année scolaire: <span style = "font-weight: bold; color: #ffaa01; font-size: 17px;"> << {{annee.debutAnnee|date:"Y"}}-{{annee.fintAnnee|date:"Y"}}>> </span></h6>
                            </div>

                           <div class="table-wrapper">
                             <table>
                                <thead>
                                    <tr>
                                        <th>Heure / Jour</th>
                                        {% for jour in jours %}
                                            <th>{{ jour }}</th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if heures %}
                                        {% for heure in heures %}
                                        <tr>
                                            <td>{{ heure }}</td>
                                            {% for jour in jours %}
                                                {% with ligne=emploi_dict|dict_get:heure %}
                                                    {% with emploi=ligne|dict_get:jour %}
                                                        <td>
                                                            {% if emploi %}
                                                                {{ emploi.cours.matiere.code }}
                                                            {% else %}
                                                                -
                                                            {% endif %}
                                                        </td>
                                                    {% endwith %}
                                                {% endwith %}
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan= "7" style= "text-align: center;">Aucun emploi du temps ajouté! Veillez cliquer sur Ajout nouvel emploi pour ajouter.</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                             </table>
                             <div class="col-12 form-group mg-t-8" style="display: flex; justify-content: center; gap: 10px;">
                                <button type="submit" class="btn-fill-lg btn-gradient-yellow btn-hover-bluedark">Mettre à jour</button>
                                <a href="{% url 'secretaire:supprimerEmploiTemps' salle.id annee.id %}" class="btn-fill-lg bg-blue-dark btn-hover-yellow" onclick="return confirm('Voulez-vous vraiment supprimer cet emploi du temps?')">Supprimer</a>
                            </div>
                            </div>

                        </div>
                        
                    </div>
                </div>
                <!-- etudiant Details Area End Here -->
                {% include 'partial/copyright.html' %}

            </div>
        </div>
        <!-- Page Area End Here -->
    </div>
   <!-- jQuery -->
    <script src="{% static 'secretaire/js/jquery-3.3.1.min.js' %}"></script>
    <!-- Plugins js -->
    <script src="{% static 'secretaire/js/plugins.js' %}"></script>
    <!-- Popper js -->
    <script src="{% static 'secretaire/js/popper.min.js' %}"></script>
    <!-- Bootstrap js -->
    <script src="{% static 'secretaire/js/bootstrap.min.js' %}"></script>
    <!-- Scroll Up Js -->
    <script src="{% static 'secretaire/js/jquery.scrollUp.min.js' %}"></script>
    <!-- Custom Js -->
    <script src="{% static 'secretaire/js/main.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>


    <script>
        // Fonction pour ouvrir la modal
        function openModal(salle, annee) {
            //document.getElementById('salleId').value = salle;
            //document.getElementById('anneeId').value = annee;
            document.getElementById('modalOverlay').style.display = 'block';
            document.body.style.overflow = 'hidden'; // Empêche le scroll de la page
            
            document.querySelector('.modal-header-custom h4').textContent = `Salle ${salle} annee ${annee}`;
        }


        // Fonction pour fermer la modal
        function closeModal() {
            document.getElementById('modalOverlay').style.display = 'none';
            document.body.style.overflow = 'auto'; // Réactive le scroll
           // document.getElementById('successMessage').style.display = 'none';
            document.getElementById('responseForm').reset();
        }

        // Fermer la modal en cliquant sur l'overlay
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });


    </script>
        
</body>

</html>